datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                 String            @id @default(uuid())
  email              String            @unique
  password_hash      String
  display_name       String
  avatar_url         String?
  created_at         DateTime          @default(now())

  habits             Habit[]
  completions        Completion[]
  group_memberships  GroupMember[]
  notification_pref  NotificationPref?
  created_groups     Group[]           @relation("GroupCreator")
}

model Habit {
  id          String       @id @default(uuid())
  user_id     String
  title       String
  description String?
  frequency   Frequency    @default(DAILY)
  color       String       @default("#6366F1")
  icon        String       @default("target")
  is_active   Boolean      @default(true)
  created_at  DateTime     @default(now())

  user        User         @relation(fields: [user_id], references: [id], onDelete: Cascade)
  completions Completion[]
}

enum Frequency {
  DAILY
  WEEKLY
  WEEKDAYS
}

model Completion {
  id             String   @id @default(uuid())
  habit_id       String
  user_id        String
  completed_date DateTime
  created_at     DateTime @default(now())

  habit          Habit    @relation(fields: [habit_id], references: [id], onDelete: Cascade)
  user           User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([habit_id, completed_date])
}


model Group {
  id          String        @id @default(uuid())
  name        String
  description String?
  invite_code String        @unique @default(cuid())
  created_by  String
  created_at  DateTime      @default(now())

  creator     User          @relation("GroupCreator", fields: [created_by], references: [id], onDelete: Cascade)
  members     GroupMember[]
}

model GroupMember {
  id        String    @id @default(uuid())
  group_id  String
  user_id   String
  role      GroupRole @default(MEMBER)
  joined_at DateTime  @default(now())

  group     Group     @relation(fields: [group_id], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([group_id, user_id])
}

enum GroupRole {
  OWNER
  MEMBER
}


model NotificationPref {
  id            String   @id @default(uuid())
  user_id       String   @unique
  email_alerts  Boolean  @default(true)
  push_alerts   Boolean  @default(true)
  reminder_time String   @default("09:00")

  user          User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}
